<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head>
	    <title>SiwBooks | Home</title>
		<link rel="stylesheet" th:href="@{/styleIndex.css}">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	</head>
	<body class="body-index">
		<!-- Alert -->
		<div class="alert alert-primary" role="alert" th:text="${aggiungiLibroSuccesso}" th:if="${aggiungiLibroSuccesso}"></div>
		<div class="alert alert-primary" role="alert" th:text="${aggiungiAutoreSuccesso}" th:if="${aggiungiAutoreSuccesso}"></div>
		<div class="alert alert-primary" role="alert" th:text="${cancellaLibroSuccesso}" th:if="${cancellaLibroSuccesso}"></div>
		<div class="alert alert-primary" role="alert" th:text="${cancellaRecensioneSuccesso}" th:if="${cancellaRecensioneSuccesso}"></div>
		<div class="alert alert-primary" role="alert" th:text="${modificaLibroSuccesso}" th:if="${modificaLibroSuccesso}"></div>
		<div class="alert alert-primary" role="alert" th:text="${inserisciRecensioneSuccesso}" th:if="${inserisciRecensioneSuccesso}"></div>
		
		<!-- Utente non Loggato -->
		<div th:if="${userDetails == null}">
		    <h1 class="welcome">Benvenuto visitatore!</h1>
			<form th:action="@{/login}" method="GET">
				<button class="accedi" type="submit">Accedi</button>
			</form>
			<form th:action="@{/register}" method="GET">
				<button class="register" type="submit">Registrati</button>
			</form>
		</div>
		
		<!-- Utente Loggato -->
		<div th:if="${userDetails != null}">
		    <div sec:authorize="hasAuthority('ADMIN')">
				<h1 class="welcome">Benvenuto/a <span class="welcome1" th:text="${userDetails.username + ' - ADMIN'}"></span></h1>
				<form th:action="@{/logout}" method="GET">
					<button class="logout" type="submit">Logout</button>
				</form>
			</div>
			<h1 class="welcome">Benvenuto/a <span class="welcome1" th:text="${userDetails.username}"></span></h1>
			<form th:action="@{/logout}" method="GET">
				<button class="logout" type="submit">Logout</button>
			</form>
		</div>
	
		<!-- Pulsanti Amministratore -->
		<div sec:authorize="hasAuthority('ADMIN')">
	        <form th:action="@{/amministratore/newLibro}" method="GET">
	            <button class="libro" type="submit">Inserisci Nuovo Libro</button>
	        </form>
	        <form th:action="@{/amministratore/newAutore}" method="GET">
	            <button class="autore" type="submit">Inserisci Nuovo Autore</button>
	        </form>
			<form th:action="@{/amministratore/autori}" method="GET">
				<button class="lista-autori" type="submit">Vedi lista degli autori</button>
			</form>
		</div>
	
		<!-- Pulsanti Utente -->
		<div sec:authorize="hasAuthority('USER')">
			<form th:action="@{/utente/newrecensione}" method="GET">
				<button class="recensione" type="submit">Inserisci Recensione</button>
			</form>
		</div>
	
	    <!-- Contenitore per la Collezione di Libri -->
	    <div class="container-libri">
	        <div th:if="${libri.isEmpty()}">
	            <h2>La nostra collezione di Libri</h2>
	            <p>Al momento non ci sono libri nel nostro catalogo. Torna a trovarci presto!</p>
	        </div>
	        
	        <div th:unless="${libri.isEmpty()}">
	            <h2>La nostra collezione di Libri</h2>
	            <ul class="libri-list">
	                <li th:each="libro : ${libri}" class="libro-item">
	                    <div th:if="${libro.immagini != null and not #lists.isEmpty(libro.immagini)}">
	                        <img class="libro-copertina" th:src="@{/immagini/{id}(id=${libro.immagini[0].id})}" alt="Copertina">
	                    </div>
	                    <div th:unless="${libro.immagini != null and not #lists.isEmpty(libro.immagini)}">
	                        <img class="libro-copertina" th:src="@{/images/placeholder-copertina.png}" alt="Copertina non disponibile" />
	                    </div>
	
	                    <h3 th:text="${libro.titolo}">Titolo del Libro</h3>
	                    
	                    <p class="autori">
	                        Autore/i:
	                        <span th:each="autore, iterStat : ${libro.autori}">
	                            <a th:href="@{/viewAutore/{idAutore}(idAutore=${autore.id})}" th:text="${autore.nome + ' ' + autore.cognome}">Nome Autore</a><span th:if="${!iterStat.last}">, </span>
	                        </span>
	                    </p>
	
	                    <p>Anno: <span th:text="${libro.anno}">Anno</span></p>
	
	                    <div class="links">
	                        <a th:href="@{/recensioni/libro/{id}(id=${libro.id})}">Recensioni</a>
	                        <a th:href="@{/viewImmagine/{id}(id=${libro.id})}">Galleria</a>
	                    </div>
	                    
	                    <div sec:authorize="hasAuthority('ADMIN')" class="admin-actions">
	                        <a th:href="@{/amministratore/modificalibro/{id}(id=${libro.id})}">Modifica</a>
	                        <a th:href="@{/amministratore/cancellalibro/{libroId}(libroId=${libro.id})}">Cancella</a>
	                    </div>
	                </li>
	            </ul>
	        </div>
	    </div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
	</body>
</html>